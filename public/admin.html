<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>ç®¡ç†å¾Œå° - è©•åˆ†è¨­å®š</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ¥‡ è©•åˆ†ç³»çµ± - ç®¡ç†å¾Œå°</h1>
        <p>åœ¨é€™è£¡è¨­å®šè©•åˆ†é …ç›®å’Œçµ„åˆ¥ã€‚<strong>æ³¨æ„ï¼šå„²å­˜æ–°è¨­å®šå°‡æœƒæ¸…é™¤æ‰€æœ‰å·²æœ‰çš„è©•åˆ†ï¼</strong></p>

        <div class="setup-section">
            <div class="setup-box">
                <h3>è©•åˆ†é …ç›®</h3>
                <input type="text" id="item-input" placeholder="ä¾‹å¦‚ï¼šç°¡å ±æŠ€å·§">
                <button id="add-item">æ–°å¢</button>
                <ul id="items-list"></ul>
            </div>
            <div class="setup-box">
                <h3>çµ„åˆ¥åç¨±</h3>
                <input type="text" id="group-input" placeholder="ä¾‹å¦‚ï¼šAçµ„">
                <button id="add-group">æ–°å¢</button>
                <ul id="groups-list"></ul>
            </div>
        </div>

        <button id="save-config">å„²å­˜è¨­å®š (ä¸¦é‡è¨­åˆ†æ•¸)</button>
        <div id="message" class="message-box"></div>

        <div class="nav-links">
            <a href="/scorer.html" target="_blank">å‰å¾€è©•åˆ†é é¢</a>
            <a href="/results.html" target="_blank">æŸ¥çœ‹çµæœé é¢</a>
        </div>
    </div>
    <script>
        let items = [];
        let groups = [];
        const itemInput = document.getElementById('item-input');
        const itemsList = document.getElementById('items-list');
        const groupInput = document.getElementById('group-input');
        const groupsList = document.getElementById('groups-list');
        const saveBtn = document.getElementById('save-config');
        const messageDiv = document.getElementById('message');

        document.getElementById('add-item').onclick = () => addToList(items, itemInput, itemsList, 'item');
        document.getElementById('add-group').onclick = () => addToList(groups, groupInput, groupsList, 'group');

        function addToList(list, input, ul, type) {
            const text = input.value.trim();
            if (text) {
                list.push(text);
                input.value = '';
                renderList(list, ul, type);
            }
        }

        function renderList(list, ul, type) {
            ul.innerHTML = '';
            list.forEach((item, index) => {
                ul.innerHTML += `<li>${item} <button class"del-btn" onclick="removeItem('${type}', ${index})">X</button></li>`;
            });
        }

        function removeItem(type, index) {
            (type === 'item' ? items : groups).splice(index, 1);
            renderList(type === 'item' ? items : itemsList, type === 'group' ? groups : groupsList, type);
        }

        // è¼‰å…¥ç›®å‰è¨­å®š
        async function loadConfig() {
            try {
                const res = await fetch('/api/config');
                const config = await res.json();
                items = config.items || [];
                groups = config.groups || [];
                renderList(items, itemsList, 'item');
                renderList(groups, groupsList, 'group');
            } catch (e) { console.error('ç„¡æ³•è¼‰å…¥è¨­å®š', e); }
        }

        // å„²å­˜è¨­å®š
        saveBtn.onclick = async () => {
            if (items.length === 0 || groups.length === 0) {
                showMessage('é …ç›®å’Œçµ„åˆ¥ä¸èƒ½ç‚ºç©º', 'error');
                return;
            }
            if (!confirm('ç¢ºå®šè¦å„²å­˜æ–°è¨­å®šå—ï¼Ÿé€™å°‡æœƒæ¸…é™¤æ‰€æœ‰èˆŠçš„è©•åˆ†ç´€éŒ„ï¼')) {
                return;
            }

            try {
                const res = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ items, groups })
                });
                const data = await res.json();
                if (res.ok) {
                    showMessage('è¨­å®šå·²æˆåŠŸå„²å­˜ï¼', 'success');
                } else {
                    showMessage(`å„²å­˜å¤±æ•—: ${data.message}`, 'error');
                }
            } catch (e) {
                showMessage(`å„²å­˜å¤±æ•—: ${e.message}`, 'error');
            }
        };

        function showMessage(msg, type) {
            messageDiv.textContent = msg;
            messageDiv.className = `message-box ${type}`;
        }

        window.onload = loadConfig;
    </script>
</body>
</html>